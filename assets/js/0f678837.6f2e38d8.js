"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1439],{99842:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});var o=t(85893),r=t(3905);const a={title:"Target nodes spec",weight:10},s=void 0,i={id:"usage/target-nodes-spec",title:"Target nodes spec",description:"Target nodes spec",source:"@site/docs/usage/target-nodes-spec.md",sourceDirName:"usage",slug:"/usage/target-nodes-spec",permalink:"/docs/usage/target-nodes-spec",draft:!1,unlisted:!1,editUrl:"https://github.com/distribworks/dkron/tree/main/website/docs/docs/usage/target-nodes-spec.md",tags:[],version:"current",frontMatter:{title:"Target nodes spec",weight:10},sidebar:"tutorialSidebar",previous:{title:"Embedded storage",permalink:"/docs/usage/storage"},next:{title:"Upgrade methods",permalink:"/docs/usage/upgrade"}},l={},d=[{value:"Target nodes spec",id:"target-nodes-spec",level:2},{value:"Target all nodes with a tag",id:"target-all-nodes-with-a-tag",level:4},{value:"Target only one nodes of a group of nodes with a tag",id:"target-only-one-nodes-of-a-group-of-nodes-with-a-tag",level:4},{value:"Details and limitations",id:"details-and-limitations",level:3}];function c(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.ah)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"target-nodes-spec",children:"Target nodes spec"}),"\n",(0,o.jsx)(n.p,{children:"Default is for all nodes to execute each job. Dkron has the ability to run jobs in specific nodes by leveraging the use of tags. You can choose whether a job is run on a node or group of nodes by specifying tags and a count of target nodes having this tag do you want a job to run."}),"\n",(0,o.jsx)(n.p,{children:"The target node syntax is:"}),"\n",(0,o.jsxs)(n.p,{children:['"tag": "value[',":count",']"']}),"\n",(0,o.jsx)(n.p,{children:"To achieve this Nodes and Jobs have tags, for example, having a node with the following tags:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "tags": {\n        "dc": "dc1",\n        "expect": "3",\n        "port": "6868",\n        "region": "global",\n        "role": "dkron",\n        "rpc_addr": "10.88.94.129:6868",\n        "server": "true",\n        "version": "devel",\n        "my_role": "web"\n    }\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["You can specify tags for nodes in the dkron config file or in the command line using ",(0,o.jsx)(n.code,{children:"--tags"})," parameter"]})}),"\n",(0,o.jsx)(n.p,{children:"In case there is no matching nodes with the specified tags, the job will not run."}),"\n",(0,o.jsx)(n.p,{children:"Following some examples using different tag combinations:"}),"\n",(0,o.jsx)(n.h4,{id:"target-all-nodes-with-a-tag",children:"Target all nodes with a tag"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "name": "job_name",\n    "command": "/bin/true",\n    "schedule": "@every 2m",\n    "tags": {\n        "my_role": "web"\n    }\n}\n'})}),"\n",(0,o.jsx)(n.mermaid,{value:'graph LR;\n    J("Job tags: #quot;my_role#quot;: #quot;web#quot;") --\x3e|Run Job|N1["Node1 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J --\x3e|Run Job|N2["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J --\x3e|Run Job|N3["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]'}),"\n",(0,o.jsx)(n.h4,{id:"target-only-one-nodes-of-a-group-of-nodes-with-a-tag",children:"Target only one nodes of a group of nodes with a tag"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "name": "job_name",\n    "command": "/bin/true",\n    "schedule": "@every 2m",\n    "tags": {\n        "my_role": "web:1"\n    }\n}\n'})}),"\n",(0,o.jsx)(n.mermaid,{value:'graph LR;\n    J("Job tags: #quot;my_role#quot;: #quot;web:1#quot;") --\x3e|Run Job|N1["Node1 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J -.- N2["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]\n    J -.- N3["Node2 tags: #quot;my_role#quot;: #quot;web#quot;"]'}),"\n",(0,o.jsx)(n.p,{children:"Dkron will try to run the job in the amount of nodes indicated by that count having that tag."}),"\n",(0,o.jsx)(n.h3,{id:"details-and-limitations",children:"Details and limitations"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Tags specified in a Job are combined using ",(0,o.jsx)(n.code,{children:"AND"}),", therefore a job that specifies several tags like:"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "tags": {\n        "my_role": "web",\n        "role": "dkron"\n    }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Will try to run the job in nodes that have all speciefied tags."}),"\n",(0,o.jsx)(n.p,{children:"There is no limit in the tags that a job can have but having a Job with several tags with count like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "tags": {\n        "my_role": "web:1",\n        "role": "dkron:2"\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Will try to run the job in nodes that have all specified tags and using the lowest count. In the last example, it will run in ",(0,o.jsx)(n.strong,{children:"one"})," node having ",(0,o.jsx)(n.code,{children:'"my_role": "web"'})," and ",(0,o.jsx)(n.code,{children:'"role": "dkron"'})," tag, even if there is more than one node with these tags."]})]})}function u(e={}){const{wrapper:n}={...(0,r.ah)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},3905:(e,n,t)=>{t.d(n,{ah:()=>d});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},u=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),g=d(t),h=r,p=g["".concat(l,".").concat(h)]||g[h]||c[h]||a;return t?o.createElement(p,s(s({ref:n},u),{},{components:t})):o.createElement(p,s({ref:n},u))}));u.displayName="MDXCreateElement"}}]);